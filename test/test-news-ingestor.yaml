apiVersion: batch/v1
kind: Job
metadata:
  name: test-news-ingestor
  namespace: agi
spec:
  template:
    spec:
      containers:
      - name: news-ingestor
        image: stevef1uk/data-processor:secure-fixed2
        imagePullPolicy: IfNotPresent
        args: ["-url", "https://www.bbc.com/news", "-max", "50", "-debug"]
        env:
        - name: NATS_URL
          value: "nats://nats.agi.svc.cluster.local:4222"
        - name: REDIS_URL
          value: "redis://redis.agi.svc.cluster.local:6379"
        - name: OLLAMA_URL
          value: "http://192.168.1.45:11434/api/chat"
        - name: OLLAMA_MODEL
          value: "Qwen2.5-VL-7B-Instruct:latest"
        - name: SECURE_CUSTOMER_PRIVATE_PATH
          value: "/keys/customer_private.pem"
        - name: SECURE_VENDOR_TOKEN
          valueFrom:
            secretKeyRef:
              key: token
              name: secure-vendor
        - name: UNPACK_WORK_DIR
          value: "/tmp/unpack"
        volumeMounts:
        - name: customer-key
          mountPath: /keys
          readOnly: true
      volumes:
      - name: customer-key
        secret:
          secretName: secure-customer-private
      restartPolicy: Never
