# Artificial Mind System API Reference

This document provides comprehensive API reference for the Artificial Mind system components.

## Table of Contents

- [Principles API (Port 8080)](#principles-api-port-8080)
- [HDN API (Port 8081)](#hdn-api-port-8081)
- [Monitor UI (Port 8082)](#monitor-ui-port-8082)
  - [Reasoning Layer APIs](#reasoning-layer-apis)
  - [Reflection Endpoint](#reflection-endpoint)
- [Available Tools](#available-tools)
- [Response Formats](#response-formats)
- [Error Handling](#error-handling)

## Principles API (Port 8080)

### Check Action Ethics
```
POST /action
```
Check if an action is ethically allowed.

**Request Body:**
```json
{
  "action": "steal",
  "context": {
    "target": "money",
    "amount": 100
  }
}
```

**Response:**
```json
{
  "allowed": false,
  "reason": "Action would harm a human (First Law)"
}
```

## HDN API (Port 8081)

### Health Check
```
GET /health
```
Returns server status and version information.

**Response:**
```json
{
  "status": "healthy",
  "timestamp": "2025-09-27T22:41:32+02:00",
  "version": "1.0.0"
}
```

### Natural Language Processing

#### Interpret and Execute (RECOMMENDED)
```
POST /api/v1/interpret/execute
```
**RECOMMENDED** - Interpret and execute natural language commands. This is the most user-friendly way to interact with the system.

**Request Body:**
```json
{
  "input": "Can you scrape https://example.com and show me the content?"
}
```

**Response:**
```json
{
  "success": true,
  "interpretation": {
    "success": true,
    "tasks": [],
    "message": "Tool executed successfully",
    "session_id": "session_1234567890",
    "interpreted_at": "2025-09-27T22:45:08.682272282+02:00"
  },
  "execution_plan": [
    {
      "task": {
        "task_name": "Tool Execution",
        "description": "",
        "context": null,
        "language": "",
        "force_regenerate": false,
        "max_retries": 0,
        "timeout": 0,
        "is_multi_step": false,
        "original_input": ""
      },
      "success": true,
      "result": "map[body:<!DOCTYPE html>...]",
      "error": "",
      "executed_at": "0001-01-01T00:00:00Z"
    }
  ],
  "message": "Successfully interpreted and executed 1 task(s)"
}
```

#### Chat Interface
```
POST /api/v1/chat/text
```
Simple text-based chat interface.

**Request Body:**
```json
{
  "message": "What tools do you have available?",
  "session_id": "test_session"
}
```

**Response:**
```
I have access to 12 different tools including:
- HTTP GET requests
- HTML scraping
- File operations
- Shell execution
- Docker management
- Code generation
- JSON parsing
- Text search
- And more!

What specific tool would you like me to use?
```

### Docker Code Execution (RECOMMENDED)

#### Execute Code
```
POST /api/v1/docker/execute
```
**RECOMMENDED** - Execute code in Docker containers. Fast and reliable for code execution.

**Request Body:**
```json
{
  "code": "def factorial(n):\n    if n <= 1:\n        return 1\n    return n * factorial(n-1)\n\nprint(\"Factorial of 5:\", factorial(5))",
  "language": "python"
}
```

**Response:**
```json
{
  "success": true,
  "output": "Factorial of 5: 120\nScanning for PDFs...\nFound 0 PDF(s) in working dir\n...",
  "exit_code": 0,
  "execution_time_ms": 459,
  "container_id": "code-executor-1234567890",
  "files": {
    "code.py": "base64_encoded_content",
    "output.txt": "base64_encoded_output"
  }
}
```

#### Calculate Primes
```
POST /api/v1/docker/primes
```
Calculate prime numbers via Docker execution.

**Request Body:**
```json
{
  "limit": 100
}
```

### Task Management

#### Execute Task
```
POST /api/v1/task/execute
```
Execute a task with optional state and context.

**Request Body:**
```json
{
  "task_name": "ScrapeWebsite",
  "context": {
    "url": "https://example.com"
  }
}
```

#### Plan Task
```
POST /api/v1/task/plan
```
Generate a plan for a task without executing it.

#### Learn New Method
```
POST /api/v1/learn
```
Learn a new method using the specified approach.

### Intelligent Execution

#### Intelligent Execute
```
POST /api/v1/intelligent/execute
```
Intelligent execution with file generation (120s timeout).

**Request Body:**
```json
{
  "task_name": "CreateHelloWorld",
  "description": "Create a simple Python script that prints hello world",
  "language": "python"
}
```

#### Calculate Primes (Intelligent)
```
POST /api/v1/intelligent/primes
```
Calculate prime numbers via intelligent execution.

#### List Capabilities
```
GET /api/v1/intelligent/capabilities
```
List cached intelligent capabilities.

### File Management

The HDN system can generate and store files (code artifacts, data files, etc.) as part of intelligent execution workflows. These endpoints allow you to retrieve files generated during workflow execution.

#### Get File by Filename
```
GET /api/v1/files/{filename}
```
Retrieve a file by its filename. Files are stored when generated by intelligent execution workflows.

**Parameters:**
- `filename` (path) - The filename of the file to retrieve

**Response:**
Returns the file content with appropriate HTTP headers:
- `Content-Type`: MIME type of the file
- `Content-Disposition`: `inline; filename={filename}`
- `Content-Length`: Size of the file in bytes

**Example:**
```bash
curl http://localhost:8081/api/v1/files/prog1.py
```

**Error Responses:**
- `400` - Bad Request (no filename provided)
- `404` - File not found

#### List Workflow Files
```
GET /api/v1/files/workflow/{workflow_id}
```
Get metadata for all files generated in a specific workflow. This endpoint returns file metadata (not file contents) for all files associated with a workflow.

**Parameters:**
- `workflow_id` (path) - The workflow ID (can be hierarchical or intelligent workflow ID)

**Response:**
```json
[
  {
    "id": "file_1234567890",
    "filename": "prog1.py",
    "content_type": "text/x-python",
    "size": 1024,
    "workflow_id": "intelligent_1234567890",
    "step_id": "docker_execution",
    "created_at": "2025-01-15T10:30:00Z",
    "expires_at": "2025-01-16T10:30:00Z"
  },
  {
    "id": "file_1234567891",
    "filename": "prog2.go",
    "content_type": "text/x-go",
    "size": 2048,
    "workflow_id": "intelligent_1234567890",
    "step_id": "docker_execution",
    "created_at": "2025-01-15T10:30:05Z",
    "expires_at": "2025-01-16T10:30:05Z"
  }
]
```

**Example:**
```bash
curl http://localhost:8081/api/v1/files/workflow/intelligent_1234567890
```

**Notes:**
- Works with both hierarchical workflow IDs and intelligent workflow IDs
- Automatically maps hierarchical workflow IDs to their corresponding intelligent workflow IDs
- Returns deduplicated files (keeps the most recent version if multiple files with the same name exist)
- Files are automatically cleaned up after expiration (default: 24 hours)

**Error Responses:**
- `400` - Bad Request (no workflow ID provided)
- `500` - Internal Server Error (failed to retrieve files)

#### Get Workflow File Content
```
GET /api/v1/workflow/{workflow_id}/files/{filename}
```
Retrieve the content of a specific file from a workflow. This endpoint reads files directly from the workflow record stored in Redis.

**Parameters:**
- `workflow_id` (path) - The workflow ID
- `filename` (path) - The filename of the file to retrieve

**Response:**
Returns the file content with appropriate HTTP headers:
- `Content-Type`: MIME type of the file (defaults to `application/octet-stream` if not specified)
- `Content-Disposition`: `inline; filename={filename}`
- `Content-Length`: Size of the file in bytes

**Example:**
```bash
curl http://localhost:8081/api/v1/workflow/intelligent_1234567890/files/prog1.py
```

**Error Responses:**
- `400` - Bad Request (workflow ID or filename missing)
- `404` - Workflow not found or file not found in workflow
- `500` - Internal Server Error (failed to parse workflow data or file content unavailable)

**Use Cases:**
- Retrieve code artifacts generated by intelligent execution
- Download data files created during workflow execution
- Access intermediate files from multi-step workflows
- Inspect generated files for debugging or validation

**Example Workflow:**
```bash
# 1. Execute intelligent workflow that generates files
curl -X POST http://localhost:8081/api/v1/intelligent/execute \
  -H "Content-Type: application/json" \
  -d '{
    "task_name": "chained_programs",
    "description": "Create two programs: prog1.py and prog2.go",
    "context": {
      "artifacts_wrapper": "true",
      "artifact_names": "prog1.py,prog2.go"
    },
    "language": "python"
  }'

# Response includes workflow_id: "intelligent_1234567890"

# 2. List all files in the workflow
curl http://localhost:8081/api/v1/files/workflow/intelligent_1234567890

# 3. Download a specific file
curl http://localhost:8081/api/v1/files/prog1.py
# OR
curl http://localhost:8081/api/v1/workflow/intelligent_1234567890/files/prog1.py
```

### Hierarchical Planning

#### Hierarchical Execute
```
POST /api/v1/hierarchical/execute
```
Asynchronous task execution (returns workflow ID).

**Request Body:**
```json
{
  "task": "CreateHelloWorld",
  "description": "Create a simple Python script that prints hello world"
}
```

**Response:**
```json
{
  "success": true,
  "workflow_id": "intelligent_1759005857295103193",
  "message": "Accepted for asynchronous execution"
}
```

#### Get Workflow Status
```
GET /api/v1/hierarchical/workflow/{id}/status
```
Check workflow execution status.

### Tools & Utilities

#### List Tools
```
GET /api/v1/tools
```
List available tools (12 tools including HTTP GET, HTML scraping, file operations, etc.).

**Response:**
```json
{
  "tools": [
    {
      "id": "tool_http_get",
      "name": "HTTP GET",
      "description": "Fetch URL",
      "input_schema": {
        "url": "string"
      },
      "output_schema": {
        "body": "string",
        "status": "int"
      },
      "permissions": ["net:read"],
      "safety_level": "low",
      "created_by": "system",
      "created_at": "2025-09-27T18:40:47.368963905Z"
    }
  ]
}
```

#### Execute Tool
```
POST /api/v1/tools/execute
```
Execute specific tools.

**Request Body:**
```json
{
  "tool_id": "tool_http_get",
  "input": {
    "url": "https://example.com"
  }
}
```

#### Register Tool
```
POST /api/v1/tools
```
Register new tools.

### State Management

#### Get State
```
GET /api/v1/state
```
Get the current world state.

#### Update State
```
PUT /api/v1/state
```
Update the world state.

#### Get Working Memory
```
GET /api/v1/state/session/{id}/working_memory
```
Get working memory for session.

### Domain Management

#### Get Domain
```
GET /api/v1/domain
```
Retrieve the current domain definition.

#### Update Domain
```
PUT /api/v1/domain
```
Update the domain definition.

#### Save Domain
```
POST /api/v1/domain/save
```
Save the current domain to file.

## Monitor UI (Port 8082)

### Dashboard
```
GET /
```
Main dashboard interface.

### Chat Interface
```
GET /chat
```
Chat interface with AI.

### Chat API
```
POST /api/chat
```
Chat API endpoint.

**Request Body:**
```json
{
  "message": "What tools do you have available?",
  "session_id": "test_session"
}
```

### Natural Language Processing
```
POST /api/interpret
```
Natural language interpretation.

```
POST /api/interpret/execute
```
Natural language interpretation and execution.

### Reasoning Layer APIs

#### Get Reasoning Traces
```
GET /api/reasoning/traces/:domain
```
Get reasoning traces for a specific domain.

**Parameters:**
- `domain` (path) - Domain name (e.g., "General", "Science")

**Response:**
```json
{
  "traces": [
    {
      "goal": "Understand quantum mechanics",
      "conclusion": "Quantum mechanics involves wave-particle duality",
      "confidence": 0.85,
      "steps": [...]
    }
  ]
}
```

#### Get Beliefs
```
GET /api/reasoning/beliefs/:domain
```
Get current beliefs for a domain.

**Parameters:**
- `domain` (path) - Domain name

**Response:**
```json
{
  "beliefs": [
    {
      "statement": "Quantum mechanics is a fundamental theory",
      "confidence": 0.9,
      "source": "knowledge_base",
      "domain": "Science"
    }
  ]
}
```

#### Get Curiosity Goals
```
GET /api/reasoning/curiosity-goals/:domain
```
Get active curiosity-driven exploration goals.

**Parameters:**
- `domain` (path) - Domain name

**Response:**
```json
{
  "goals": [
    {
      "id": "curiosity_001",
      "description": "Explore quantum entanglement",
      "type": "exploration",
      "priority": 5,
      "status": "active"
    }
  ]
}
```

#### Get Hypotheses
```
GET /api/reasoning/hypotheses/:domain
```
Get generated and tested hypotheses.

**Parameters:**
- `domain` (path) - Domain name

**Response:**
```json
{
  "hypotheses": [
    {
      "id": "hyp_001",
      "description": "Quantum entanglement affects measurement outcomes",
      "status": "tested",
      "confidence": 0.75,
      "domain": "Science"
    }
  ]
}
```

#### Get Reasoning Explanations
```
GET /api/reasoning/explanations/:goal
```
Get human-readable explanations for a specific goal.

**Parameters:**
- `goal` (path) - Goal identifier

**Response:**
```json
{
  "explanations": [
    {
      "goal": "Understand quantum mechanics",
      "explanation": "The system reasoned about quantum mechanics by...",
      "generated_at": "2025-11-13T16:20:00Z"
    }
  ]
}
```

#### Get Recent Explanations
```
GET /api/reasoning/explanations
```
Get recent explanations across all goals.

**Response:**
```json
{
  "explanations": [...]
}
```

#### Get Reasoning Domains
```
GET /api/reasoning/domains
```
Get list of all domains with reasoning data.

**Response:**
```json
{
  "domains": ["General", "Science", "Maths"],
  "belief_domains": ["General", "Science"],
  "curiosity_domains": ["General", "Science", "Maths"]
}
```

### Reflection Endpoint

#### Get System Reflection
```
GET /api/reflect
```
**NEW** - Comprehensive introspection endpoint that aggregates the system's current mental state. This provides a unified view of what the AI is thinking, believing, curious about, and doing.

**Query Parameters:**
- `domain` (optional) - Filter by reasoning domain (default: "General")

**Response:**
```json
{
  "timestamp": "2025-11-13T16:20:35+01:00",
  "domain": "General",
  "fsm_thinking": {
    "current_state": "act",
    "thinking_focus": "Executing actions with safety monitoring",
    "confidence_level": 0.8,
    "next_actions": [...]
  },
  "reasoning_traces": [
    {
      "goal": "Understand quantum mechanics",
      "conclusion": "...",
      "confidence": 0.85,
      "steps": [...]
    }
  ],
  "beliefs": [
    {
      "statement": "Quantum mechanics involves wave-particle duality",
      "confidence": 0.9,
      "source": "knowledge_base",
      "domain": "Science"
    }
  ],
  "curiosity_goals": [
    {
      "id": "curiosity_001",
      "description": "Explore quantum entanglement",
      "type": "exploration",
      "priority": 5
    }
  ],
  "hypotheses": [
    {
      "id": "hyp_001",
      "description": "Quantum entanglement affects measurement outcomes",
      "status": "tested",
      "confidence": 0.75
    }
  ],
  "recent_tool_calls": [
    {
      "id": "tool_call_123",
      "tool_id": "tool_http_get",
      "status": "success",
      "timestamp": "2025-11-13T16:19:00Z"
    }
  ],
  "working_memory": {
    "recent_episodes": [...],
    "active_context": "..."
  },
  "active_goals": [
    {
      "id": "goal_001",
      "description": "Learn about quantum mechanics",
      "status": "in_progress"
    }
  ],
  "explanations": [
    {
      "goal": "Understand quantum mechanics",
      "explanation": "The system reasoned that...",
      "generated_at": "2025-11-13T16:20:00Z"
    }
  ],
  "summary": {
    "reasoning_traces_count": 10,
    "beliefs_count": 12,
    "curiosity_goals_count": 3,
    "hypotheses_count": 10,
    "explanations_count": 5,
    "fsm_state": "act",
    "fsm_thinking_focus": "Executing actions with safety monitoring"
  }
}
```

**Use Cases:**
- **Debugging**: See what the system is currently thinking and why
- **Monitoring**: Track the system's mental state over time
- **Transparency**: Understand AI decision-making processes
- **Development**: Inspect reasoning traces and beliefs during development

**Example Usage:**
```bash
# Get full reflection
curl http://localhost:8082/api/reflect

# Filter by domain
curl http://localhost:8082/api/reflect?domain=Science

# Get just the summary
curl http://localhost:8082/api/reflect | jq '.summary'
```

## Available Tools

The system includes 12 built-in tools:

1. **HTTP GET** (`tool_http_get`) - Fetch URLs
2. **HTML Scraper** (`tool_html_scraper`) - Parse HTML and extract content
3. **File Reader** (`tool_file_read`) - Read files
4. **File Writer** (`tool_file_write`) - Write files
5. **List Directory** (`tool_ls`) - List directory contents
6. **Shell Exec** (`tool_exec`) - Run shell commands (sandboxed)
7. **Docker List** (`tool_docker_list`) - List Docker entities
8. **Codegen** (`tool_codegen`) - Generate code via LLM
9. **Docker Build** (`tool_docker_build`) - Build Docker images
10. **Register Tool** (`tool_register`) - Register tool metadata
11. **JSON Parse** (`tool_json_parse`) - Parse JSON
12. **Text Search** (`tool_text_search`) - Search text

## Response Formats

### Success Response
```json
{
  "success": true,
  "data": { ... },
  "message": "Operation completed successfully"
}
```

### Error Response
```json
{
  "success": false,
  "error": "Error message",
  "code": "ERROR_CODE"
}
```

### Task Execution Response
```json
{
  "success": true,
  "plan": ["Task1", "Task2", "Task3"],
  "message": "Task executed successfully",
  "new_state": {
    "task1_completed": true,
    "task2_completed": true,
    "task3_completed": true
  }
}
```

## Error Handling

### Common Error Codes

- `400` - Bad Request (invalid JSON, missing required fields)
- `404` - Not Found (endpoint or resource not found)
- `429` - Too Many Requests (rate limiting)
- `500` - Internal Server Error
- `502` - Bad Gateway (service unavailable)

### Error Response Format
```json
{
  "error": "Error message",
  "code": "ERROR_CODE",
  "details": "Additional error details"
}
```

## Rate Limiting

Some endpoints have rate limiting:
- Intelligent execution: Limited concurrent executions
- Tool execution: May have timeouts for long-running operations

## Authentication

Currently, the API does not require authentication. This may change in future versions.

## CORS

The API supports CORS for web applications. All origins are currently allowed.

## Examples

### Web Scraping
```bash
curl -X POST http://localhost:8081/api/v1/interpret/execute \
  -H "Content-Type: application/json" \
  -d '{
    "input": "Can you scrape https://example.com and show me the content?"
  }'
```

### Code Execution
```bash
curl -X POST http://localhost:8081/api/v1/docker/execute \
  -H "Content-Type: application/json" \
  -d '{
    "code": "print(\"Hello, World!\")",
    "language": "python"
  }'
```

### Chat Interface
```bash
curl -X POST http://localhost:8081/api/v1/chat/text \
  -H "Content-Type: application/json" \
  -d '{
    "message": "What can you help me with?",
    "session_id": "test_session"
  }'
```

### File Management
```bash
# Execute a workflow that generates files
curl -X POST http://localhost:8081/api/v1/intelligent/execute \
  -H "Content-Type: application/json" \
  -d '{
    "task_name": "create_artifacts",
    "description": "Create a Python script and a Go program",
    "context": {
      "artifacts_wrapper": "true",
      "artifact_names": "script.py,program.go"
    },
    "language": "python"
  }'

# Response includes workflow_id, e.g., "intelligent_1234567890"

# List all files in the workflow
curl http://localhost:8081/api/v1/files/workflow/intelligent_1234567890

# Download a specific file by filename
curl http://localhost:8081/api/v1/files/script.py

# Or download from a specific workflow
curl http://localhost:8081/api/v1/workflow/intelligent_1234567890/files/script.py
```
